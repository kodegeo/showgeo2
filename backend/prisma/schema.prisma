generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model analytics_summaries {
  id              String               @id
  entityId        String?
  eventId         String?
  userId          String?
  type            AnalyticsSummaryType
  metrics         Json
  engagementScore Float?
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt
  entities        entities?            @relation(fields: [entityId], references: [id], onDelete: Cascade)
  events          events?              @relation(fields: [eventId], references: [id], onDelete: Cascade)
  app_users       app_users?           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([entityId, type])
  @@unique([eventId, type])
  @@unique([userId, type])
}

model app_users {
  id                  String                @id(map: "users_pkey")
  email               String                @unique(map: "users_email_key")
  password            String?
  role                UserRole              @default(USER)
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  authUserId          String?               @unique @db.Uuid

  isEntity            Boolean               @default(false) @map("is_entity")

  analytics_summaries analytics_summaries[]
  entities            entities[]
  entity_roles        entity_roles[]
  events              events[]
  follows             follows[]
  notifications       notifications[]
  orders              orders[]
  tickets             tickets[]
  user_profiles       user_profiles?
}

model assets {
  id              String @id      @default(uuid())  
  ownerId         String
  ownerType       AssetOwnerType
  url             String
  path            String
  type            AssetType
  mimeType        String?
  size            Int?
  width           Int?
  height          Int?
  duration        Int?
  metadata        Json?
  isPublic        Boolean         @default(false)
  storageProvider StorageProvider @default(SUPABASE)
  expiresAt       DateTime?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  @@index([isPublic])
  @@index([ownerId, ownerType])
  @@index([type])
}

model chat_rooms {
  id        String   @id
  eventId   String
  name      String?
  isPrivate Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  events    events   @relation(fields: [eventId], references: [id], onDelete: Cascade)
}

model entities {
  id                                    String                @id
  ownerId                               String
  type                                  EntityType            @default(INDIVIDUAL)
  name                                  String
  slug                                  String                @unique
  bio                                   String?
  tags                                  String[]
  thumbnail                             String?
  bannerImage                           String?
  location                              String?
  website                               String?
  socialLinks                           Json?
  isVerified                            Boolean               @default(false)
  isPublic                              Boolean               @default(true)
  defaultCoordinatorId                  String?
  createdAt                             DateTime              @default(now())
  updatedAt                             DateTime              @updatedAt
  status                                EntityStatus          @default(PENDING)
  analytics_summaries                   analytics_summaries[]
  app_users                             app_users             @relation(fields: [ownerId], references: [id])
  entity_roles                          entity_roles[]
  events_events_entityIdToentities      events[]              @relation("events_entityIdToentities")
  follows                               follows[]
  notifications                         notifications[]
  orders                                orders[]
  stores_stores_entityIdToentities      stores[]              @relation("stores_entityIdToentities")
  streaming_sessions                    streaming_sessions[]
  tours_tours_primaryEntityIdToentities tours[]               @relation("tours_primaryEntityIdToentities")
  events_EventCollaborators             events[]              @relation("EventCollaborators")
  stores_StoreCollaborators             stores[]              @relation("StoreCollaborators")
  tours_TourCollaborators               tours[]               @relation("TourCollaborators")
}

model entity_roles {
  id        String         @id @default(uuid())
  userId    String
  entityId  String
  role      EntityRoleType @default(ADMIN)
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
  entities  entities       @relation(fields: [entityId], references: [id], onDelete: Cascade)
  app_users app_users      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, entityId])
}

model events {
  id                                 String                 @id
  name                               String
  description                        String?
  thumbnail                          String?
  eventType                          EventType              @default(LIVE)
  phase                              EventPhase             @default(PRE_LIVE)
  startTime                          DateTime
  endTime                            DateTime?
  location                           String?
  status                             EventStatus            @default(DRAFT)
  entityId                           String
  eventCoordinatorId                 String?
  tourId                             String?
  isVirtual                          Boolean                @default(false)
  streamUrl                          String?
  testStreamUrl                      String?
  videoUrl                           String?
  streamingAccessLevel               GeofencingAccessLevel?
  geoRegions                         String[]
  geoRestricted                      Boolean                @default(false)
  ticketRequired                     Boolean                @default(true)
  ticketTypes                        Json?
  entryCodeRequired                  Boolean                @default(false)
  entryCodeDelivery                  Boolean                @default(false)
  ticketEmailTemplate                String?
  testingEnabled                     Boolean                @default(false)
  testResultLogs                     Json?
  liveMetrics                        Json?
  customBranding                     Json?
  createdAt                          DateTime               @default(now())
  updatedAt                          DateTime               @updatedAt
  lastLaunchedBy                     String?
  analytics_summaries                analytics_summaries[]
  chat_rooms                         chat_rooms[]
  entities_events_entityIdToentities entities               @relation("events_entityIdToentities", fields: [entityId], references: [id])
  app_users                          app_users?             @relation(fields: [eventCoordinatorId], references: [id])
  tours                              tours?                 @relation(fields: [tourId], references: [id])
  geofencing                         geofencing?
  orders                             orders[]
  stores                             stores?
  streaming_sessions                 streaming_sessions[]
  tickets                            tickets[]
  entities_EventCollaborators        entities[]             @relation("EventCollaborators")
}

model follows {
  id        String    @id
  userId    String
  entityId  String
  createdAt DateTime  @default(now())
  updatedAt DateTime @updatedAt
  entities  entities  @relation(fields: [entityId], references: [id], onDelete: Cascade)
  app_users app_users @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, entityId])
}

model geofencing {
  id          String               @id
  targetType  GeofencingTargetType
  targetId    String
  type        GeofencingType       @default(ALLOWLIST)
  regions     String[]
  description String?
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt
  eventId     String?              @unique
  tourId      String?              @unique
  storeId     String?              @unique
  events      events?              @relation(fields: [eventId], references: [id], onDelete: Cascade)
  stores      stores?              @relation(fields: [storeId], references: [id], onDelete: Cascade)
  tours       tours?               @relation(fields: [tourId], references: [id], onDelete: Cascade)
}

model notifications {
  id        String           @id
  userId    String
  entityId  String?
  type      NotificationType
  message   String
  metadata  Json?
  isRead    Boolean          @default(false)
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
  entities  entities?        @relation(fields: [entityId], references: [id], onDelete: Cascade)
  app_users app_users        @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model order_items {
  id          String    @id
  orderId     String
  ticketId    String?
  productId   String?
  quantity    Int       @default(1)
  unitPrice   Decimal   @db.Decimal(10, 2)
  totalPrice  Decimal   @db.Decimal(10, 2)
  name        String
  description String?
  metadata    Json?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime @updatedAt
  orders      orders    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  products    products? @relation(fields: [productId], references: [id])
  tickets     tickets?  @relation(fields: [ticketId], references: [id])
}

model orders {
  id                    String         @id
  userId                String
  entityId              String?
  eventId               String?
  storeId               String?
  type                  OrderType
  status                OrderStatus    @default(PENDING)
  totalAmount           Decimal        @db.Decimal(10, 2)
  currency              String         @default("USD")
  paymentMethod         PaymentMethod?
  stripePaymentIntentId String?        @unique
  stripeSessionId       String?        @unique
  metadata              Json?
  createdAt             DateTime       @default(now())
  updatedAt             DateTime      @updatedAt
  order_items           order_items[]
  entities              entities?      @relation(fields: [entityId], references: [id], onDelete: Cascade)
  events                events?        @relation(fields: [eventId], references: [id], onDelete: Cascade)
  stores                stores?        @relation(fields: [storeId], references: [id], onDelete: Cascade)
  app_users             app_users      @relation(fields: [userId], references: [id], onDelete: Cascade)
  payments              payments[]
}

model payments {
  id              String        @id
  orderId         String
  amount          Decimal       @db.Decimal(10, 2)
  currency        String        @default("USD")
  status          String
  paymentMethod   PaymentMethod
  stripePaymentId String?       @unique
  stripeChargeId  String?       @unique
  refundId        String?       @unique
  failureReason   String?
  metadata        Json?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime     @updatedAt
  orders          orders        @relation(fields: [orderId], references: [id], onDelete: Cascade)
}

model products {
  id          String        @id
  storeId     String
  name        String
  description String?
  price       Float
  currency    String        @default("USD")
  imageUrl    String?
  isDigital   Boolean       @default(false)
  isAvailable Boolean       @default(true)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime     @updatedAt
  order_items order_items[]
  stores      stores        @relation(fields: [storeId], references: [id], onDelete: Cascade)
}

model stores {
  id                                 String          @id
  entityId                           String
  eventId                            String?         @unique
  tourId                             String?         @unique
  name                               String
  slug                               String          @unique
  description                        String?
  bannerImage                        String?
  logoUrl                            String?
  currency                           String          @default("USD")
  status                             StoreStatus     @default(ACTIVE)
  visibility                         StoreVisibility @default(PUBLIC)
  collaborators                      String[]
  tags                               String[]
  createdAt                          DateTime        @default(now())
  updatedAt                          DateTime        @updatedAt
  geofencing                         geofencing?
  orders                             orders[]
  products                           products[]
  entities_stores_entityIdToentities entities        @relation("stores_entityIdToentities", fields: [entityId], references: [id])
  events                             events?         @relation(fields: [eventId], references: [id])
  tours_stores_tourIdTotours         tours?          @relation("stores_tourIdTotours", fields: [tourId], references: [id])
  entities_StoreCollaborators        entities[]      @relation("StoreCollaborators")
  tours_TourStores                   tours[]         @relation("TourStores")
}

model streaming_sessions {
  id          String               @id
  eventId     String
  entityId    String
  roomId      String               @unique
  sessionKey  String
  accessLevel StreamingAccessLevel @default(PUBLIC)
  startTime   DateTime             @default(now())
  endTime     DateTime?
  active      Boolean              @default(true)
  viewers     Int                  @default(0)
  metrics     Json?
  geoRegions  String[]
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt
  entities    entities             @relation(fields: [entityId], references: [id], onDelete: Cascade)
  events      events               @relation(fields: [eventId], references: [id], onDelete: Cascade)
}

model tickets {
  id          String        @id
  userId      String
  eventId     String
  orderId     String?
  type        TicketType
  price       Float?        @default(0)
  currency    String        @default("USD")
  entryCode   String?       @unique
  createdAt   DateTime      @default(now())
  updatedAt   DateTime     @updatedAt
  order_items order_items[]
  events      events        @relation(fields: [eventId], references: [id], onDelete: Cascade)
  app_users   app_users     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model tours {
  id                                       String                @id
  primaryEntityId                          String
  name                                     String                @unique
  slug                                     String                @unique
  description                              String?
  thumbnail                                String?
  bannerImage                              String?
  startDate                                DateTime
  endDate                                  DateTime?
  status                                   TourStatus            @default(DRAFT)
  tags                                     String[]
  geoRestricted                            Boolean               @default(false)
  streamingAccessLevel                     StreamingAccessLevel?
  geoRegions                               String[]
  createdAt                                DateTime              @default(now())
  updatedAt                                DateTime              @updatedAt
  events                                   events[]
  geofencing                               geofencing?
  stores_stores_tourIdTotours              stores?               @relation("stores_tourIdTotours")
  entities_tours_primaryEntityIdToentities entities              @relation("tours_primaryEntityIdToentities", fields: [primaryEntityId], references: [id])
  entities_TourCollaborators               entities[]            @relation("TourCollaborators")
  stores_TourStores                        stores[]              @relation("TourStores")
}

model user_profiles {
  id          String    @id
  userId      String    @unique
  username    String?   @unique
  firstName   String?
  lastName    String?
  avatarUrl   String?
  bannerUrl   String?
  bio         String?
  location    String?
  timezone    String?
  website     String?
  socialLinks Json?
  preferences Json?
  visibility  String    @default("public")
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  app_users   app_users @relation(fields: [userId], references: [id], onDelete: Cascade)
}

enum AnalyticsSummaryType {
  ENTITY
  EVENT
  USER
  PLATFORM
}

enum AssetOwnerType {
  USER
  ENTITY
}

enum AssetType {
  IMAGE
  AUDIO
  VIDEO
  DOCUMENT
  OTHER
}

enum EntityRoleType {
  OWNER
  ADMIN
  MANAGER
  COORDINATOR
}

enum EntityStatus {
  PENDING
  APPROVED
  REJECTED
}

enum EntityType {
  INDIVIDUAL
  ORGANIZATION
}

enum EventPhase {
  PRE_LIVE
  LIVE
  POST_LIVE
}

enum EventStatus {
  DRAFT
  SCHEDULED
  LIVE
  COMPLETED
  CANCELLED
}

enum EventType {
  LIVE
  PRERECORDED
}

enum GeofencingAccessLevel {
  LOCAL
  REGIONAL
  NATIONAL
  INTERNATIONAL
}

enum GeofencingTargetType {
  EVENT
  TOUR
  STORE
}

enum GeofencingType {
  ALLOWLIST
  BLOCKLIST
}

enum NotificationType {
  LIVE_NOW
  NEW_DROP
  PHASE_UPDATE
  EVENT_CREATED
  EVENT_UPDATED
  FOLLOWED_ENTITY_UPDATE
  CUSTOM
}

enum OrderStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
  REFUNDED
}

enum OrderType {
  TICKET
  PRODUCT
  SUBSCRIPTION
}

enum PaymentMethod {
  STRIPE
  CREDIT_CARD
  DEBIT_CARD
}

enum StorageProvider {
  SUPABASE
  AWS_S3
  CLOUDFLARE_R2
  LOCAL
}

enum StoreStatus {
  ACTIVE
  INACTIVE
  ARCHIVED
}

enum StoreVisibility {
  PUBLIC
  UNLISTED
  PRIVATE
}

enum StreamingAccessLevel {
  PUBLIC
  REGISTERED
  TICKETED
}

enum TicketType {
  FREE
  GIFTED
  PAID
}

enum TourStatus {
  DRAFT
  UPCOMING
  ACTIVE
  COMPLETED
}

enum UserRole {
  USER
  ENTITY
  MANAGER
  COORDINATOR
  ADMIN
}
  
